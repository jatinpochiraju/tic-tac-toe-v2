<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TicTacToe</title>
  <style>
    :root {
      --bg: #0f1220;
      --panel: #161a2b;
      --ink: #e8ebff;
      --muted: #9aa3b2;
      --accent: #6c8cff;
      --win: #2bd576;
      --lose: #ff6b6b;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 18px;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 10% -10%, #22284a 0%, transparent 60%),
                  radial-gradient(800px 600px at 110% 10%, #1b2344 0%, transparent 60%),
                  var(--bg);
      color: var(--ink);
      display: grid; place-items: center; padding: 24px;
    }
    .app {
      width: min(720px, 92vw);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }
    header {
      display: grid; grid-template-columns: 1fr auto; gap: 12px; align-items: center;
      padding: 18px 18px 0 18px;
    }
    h1 { margin: 0; font-size: clamp(20px, 3vw, 28px); letter-spacing: .5px; }

    .controls { display: flex; flex-wrap: wrap; gap: 10px; justify-content: end; }
    .btn {
      background: #222744; color: var(--ink); border: 1px solid #2c335d;
      padding: 10px 14px; border-radius: 12px; cursor: pointer; font-weight: 600;
      transition: transform .06s ease, background .25s ease, border-color .25s ease, box-shadow .2s ease;
      box-shadow: 0 4px 14px rgba(0,0,0,.25) inset;
      user-select: none;
    }
    .btn:hover { background: #2a3161; }
    .btn:active { transform: translateY(1px); }
    .btn.secondary { background: transparent; border-color: #3a447f; }

    .wrap { padding: 18px; display: grid; grid-template-columns: 1fr 320px; gap: 18px; }
    @media (max-width: 800px){ .wrap { grid-template-columns: 1fr; } }

    .board {
      aspect-ratio: 1 / 1; width: 100%;
      background: var(--panel); border-radius: var(--radius);
      display: grid; grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(3, 1fr);
      gap: 10px; padding: 10px; position: relative;
    }
    .cell {
      background: linear-gradient(180deg, #1a1f37, #13182d);
      border: 1px solid #2b3157; border-radius: 14px; display: grid; place-items: center;
      font-size: clamp(38px, 8vw, 72px); font-weight: 800; letter-spacing: 1px;
      color: var(--ink);
      cursor: pointer; user-select: none; position: relative; isolation: isolate;
      transition: transform .12s ease, border-color .25s ease, background .25s ease, box-shadow .25s ease;
      box-shadow: 0 6px 18px rgba(0,0,0,.25), inset 0 0 0 0 rgba(108,140,255,0);
    }
    .cell:hover { transform: translateY(-2px); border-color: #3a447f; box-shadow: 0 10px 24px rgba(0,0,0,.32), inset 0 0 0 1px rgba(108,140,255,.15); }
    .cell[data-disabled="true"] { cursor: not-allowed; filter: saturate(.7); }

    .cell.win { background: linear-gradient(180deg, #133225, #0f291d); border-color: #1f7a4a; box-shadow: 0 12px 30px rgba(43,213,118,.35), inset 0 0 0 1px rgba(43,213,118,.25); }
    .cell.lose { background: linear-gradient(180deg, #3a0f19, #2b0c14); border-color: #8a2a3c; box-shadow: 0 12px 30px rgba(255,107,107,.35), inset 0 0 0 1px rgba(255,107,107,.25); }
    .cell.draw { opacity: .9; }

    .panel {
      background: var(--panel); border: 1px solid #2b3157; border-radius: var(--radius);
      padding: 16px; height: 100%; display: grid; gap: 14px; align-content: start;
    }
    .status { font-weight: 700; font-size: 18px; letter-spacing: .3px; }
    .muted { color: var(--muted); font-size: 14px; }

    .score {
      display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;
    }
    .score .card {
      background: linear-gradient(180deg, #1a1f37, #13182d); border: 1px solid #2b3157; border-radius: 12px; padding: 12px; text-align: center;
    }
    .score .big { font-size: 28px; font-weight: 800; }

    .seg {
      display: grid; grid-auto-flow: column; justify-content: start; gap: 8px;
      background: #141a33; border: 1px solid #2b3157; border-radius: 12px; padding: 6px;
      width: max-content;
    }
    .seg input { display: none; }
    .seg label {
      padding: 8px 12px; border-radius: 8px; cursor: pointer; font-weight: 700; font-size: 14px; color: var(--muted);
      transition: background .2s ease, color .2s ease;
    }
    .seg input:checked + label { background: #2a3161; color: var(--ink); }

    footer { padding: 0 18px 18px 18px; }
    .hint { color: var(--muted); font-size: 12px; text-align: center; }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>tic·tac·toe</h1>
      <div class="controls">
        <div class="seg" role="tablist" aria-label="Game Mode">
          <input type="radio" id="mode2" name="mode" value="human" checked>
          <label for="mode2" title="Two players on one device">2 Players</label>
          <input type="radio" id="mode1" name="mode" value="cpu">
          <label for="mode1" title="Play vs Computer">Vs Computer</label>
        </div>
        <button class="btn secondary" id="btnSwap">Swap X/O</button>
        <button class="btn" id="btnReset">Reset</button>
      </div>
    </header>

    <div class="wrap">
      <main class="board" id="board" aria-label="TicTacToe board" role="grid" aria-rowcount="3" aria-colcount="3"></main>
      <aside class="panel">
        <div class="status" id="status">X to move</div>
        <div class="muted" id="sub">3 in a row wins</div>
        <div class="score">
          <div class="card">
            <div class="muted">X Wins</div>
            <div class="big" id="xw">0</div>
          </div>
          <div class="card">
            <div class="muted">Draws</div>
            <div class="big" id="dw">0</div>
          </div>
          <div class="card">
            <div class="muted">O Wins</div>
            <div class="big" id="ow">0</div>
          </div>
        </div>
        <div>
          <div class="muted">Rules</div>
          <ul class="muted" style="margin:8px 0 0 18px; padding:0; line-height:1.6">
            <li>Take turns placing marks.</li>
            <li>Get three in a row to win.</li>
            <li>Reset keeps score; swap changes who is X.</li>
          </ul>
        </div>
      </aside>
    </div>

    <footer>
      <p class="hint">Keyboard: 1–9 to play • R to reset • S to swap</p>
    </footer>
  </div>

  <script>
    const boardEl = document.getElementById('board');
    const statusEl = document.getElementById('status');
    const subEl = document.getElementById('sub');
    const btnReset = document.getElementById('btnReset');
    const btnSwap = document.getElementById('btnSwap');
    const xw = document.getElementById('xw');
    const ow = document.getElementById('ow');
    const dw = document.getElementById('dw');

    const state = {
      board: Array(9).fill(null),
      xIsNext: true,
      locked: false,
      scores: { X: 0, O: 0, D: 0 },
      humanIsX: true,
      mode: 'human', // 'human' | 'cpu'
    };

    // Build cells
    const cells = [];
    for (let i = 0; i < 9; i++) {
      const c = document.createElement('button');
      c.className = 'cell';
      c.setAttribute('role', 'gridcell');
      c.setAttribute('aria-colindex', (i % 3) + 1);
      c.setAttribute('aria-rowindex', Math.floor(i / 3) + 1);
      c.dataset.idx = i;
      c.addEventListener('click', () => handleMove(i));
      cells.push(c);
      boardEl.appendChild(c);
    }

    // Mode toggles
    document.querySelectorAll('input[name="mode"]').forEach(r => r.addEventListener('change', e => {
      state.mode = e.target.value; reset(false);
      subEl.textContent = state.mode === 'cpu' ? 'You vs Computer (optimal)' : '3 in a row wins';
    }));

    btnReset.addEventListener('click', () => reset(false));
    btnSwap.addEventListener('click', () => { state.humanIsX = !state.humanIsX; reset(false); });

    window.addEventListener('keydown', (e) => {
      const k = e.key.toLowerCase();
      if (k === 'r') reset(false);
      if (k === 's') { state.humanIsX = !state.humanIsX; reset(false); }
      if ('123456789'.includes(k)) handleMove(parseInt(k,10)-1);
    });

    function reset(keepTurn) {
      state.board.fill(null);
      state.locked = false;
      for (const c of cells) c.textContent = '', c.classList.remove('win','lose','draw');
      if (!keepTurn) state.xIsNext = true;
      updateStatus();
      maybeCpu();
    }

    function updateStatus(msg){
      if (msg) { statusEl.textContent = msg; return; }
      const p = state.xIsNext ? 'X' : 'O';
      statusEl.textContent = `${p} to move`;
    }

    function handleMove(i){
      if (state.locked) return;
      const turn = state.xIsNext ? 'X' : 'O';
      const isHumanTurn = state.mode === 'human' || (state.mode === 'cpu' && ((state.humanIsX && turn==='X') || (!state.humanIsX && turn==='O')));
      if (!isHumanTurn) return; // prevent clicks during CPU turn
      if (state.board[i]) return;
      place(i, turn);
      endOrContinue();
      maybeCpu();
    }

    function place(i, player){
      state.board[i] = player;
      cells[i].textContent = player;
      state.xIsNext = !state.xIsNext;
    }

    function endOrContinue(){
      const w = winner(state.board);
      if (w) {
        state.locked = true;
        highlight(w);
        if (w.player === 'D') {
          state.scores.D++; dw.textContent = state.scores.D; updateStatus('Draw');
          cells.forEach(c=>c.classList.add('draw'));
        } else {
          state.scores[w.player]++; (w.player==='X'?xw:ow).textContent = state.scores[w.player];
          updateStatus(`${w.player} wins`);
        }
        return true;
      }
      updateStatus();
      return false;
    }

    function highlight(w){
      if (w.player === 'D') return;
      for (const i of w.line) cells[i].classList.add('win');
      for (let i=0;i<9;i++) if (!w.line.includes(i)) cells[i].classList.add('lose');
    }

    const LINES = [
      [0,1,2],[3,4,5],[6,7,8], // rows
      [0,3,6],[1,4,7],[2,5,8], // cols
      [0,4,8],[2,4,6]          // diags
    ];

    function winner(b){
      for (const line of LINES){
        const [a,b1,c] = line; const v = b[a];
        if (v && v===b[b1] && v===b[c]) return { player: v, line };
      }
      if (b.every(Boolean)) return { player: 'D', line: [] };
      return null;
    }

    function maybeCpu(){
      if (state.mode !== 'cpu' || state.locked) return;
      const player = state.xIsNext ? 'X' : 'O';
      const cpuIs = state.humanIsX ? 'O' : 'X';
      if (player !== cpuIs) return;
      // small delay for feel
      setTimeout(()=>{
        const move = bestMove(state.board, cpuIs);
        if (move != null) {
          place(move, cpuIs);
          endOrContinue();
        }
      }, 240);
    }

    function bestMove(board, ai){
      const hu = ai === 'X' ? 'O' : 'X';
      // Try winning
      for (const i of empties(board)){
        const b = board.slice(); b[i] = ai; if (winner(b)?.player === ai) return i;
      }
      // Block opponent win
      for (const i of empties(board)){
        const b = board.slice(); b[i] = hu; if (winner(b)?.player === hu) return i;
      }
      // Center > corners > sides heuristic (perfect for TicTacToe)
      const order = [4,0,2,6,8,1,3,5,7];
      for (const i of order) if (!board[i]) return i;
      return null;
    }

    const empties = (b) => b.map((v,i)=>v?null:i).filter(v=>v!=null);

    // initial
    reset(true);
  </script>
</body>
</html>
